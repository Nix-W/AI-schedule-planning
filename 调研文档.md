# AI 个人日程规划项目 - 调研文档

> 文档版本：v1.0  
> 更新日期：2026-01-23  
> 作者：[Nix]

---

## 一、项目概述

### 1.1 项目背景

传统日程管理工具需要用户手动填写时间、标题、地点等字段，操作繁琐。本项目旨在利用 AI 自然语言处理能力，让用户通过一句话描述即可自动创建日程，大幅提升日程管理效率。

### 1.2 项目目标

**用户用自然语言描述任务 → AI 自动解析 → 生成可视化日历视图**

例如：
- 输入：「明天下午3点和老王在星巴克讨论项目」
- 输出：自动创建日程，时间为明天15:00-16:00，地点星巴克，参与者老王

### 1.3 开发环境

| 项目 | 配置 |
|------|------|
| 操作系统 | macOS |
| 开发工具 | Cursor + Claude Code |
| 运行环境 | Node.js |

---

## 二、核心功能分析

### 2.1 功能链路

```
用户输入自然语言
       ↓
   前端发送请求
       ↓
   后端调用 AI API
       ↓
   AI 解析返回结构化 JSON
       ↓
   前端渲染到日历视图
       ↓
   用户确认/编辑/保存
```

### 2.2 核心能力拆解

| 能力 | 说明 | 难点 |
|------|------|------|
| 自然语言解析 | 从文本中提取时间、事件、地点、参与者 | 时间表达多样性 |
| 智能时间推理 | 理解"明天"、"下周三"、"每周五"等相对时间 | 需要注入当前时间上下文 |
| 日历视图渲染 | 月/周/日视图展示和切换 | 组件选型和数据格式对接 |
| 事件管理 | 增删改查、拖拽调整 | 用户交互体验 |
| 数据持久化 | 本地存储或云端同步 | MVP 阶段用 localStorage 即可 |

---

## 三、功能清单

### 3.1 P0 核心功能（必做）

| 功能 | 描述 | 验收标准 |
|------|------|----------|
| 后端：自然语言解析 API | 接收文本，调用 AI，返回结构化 JSON | curl 测试通过 5 个典型用例 |
| 前端：输入框 | 用户输入自然语言描述 | 支持 Enter 提交 |
| 前端：日历展示 | 展示解析后的日程事件 | 事件显示在正确的时间位置 |
| 颜色区分 | 不同类型事件用不同颜色 | 按事件类型自动着色 |

### 3.2 P1 重要功能（建议做）

| 功能 | 描述 | 价值 |
|------|------|------|
| 视图切换 | 日视图 / 周视图 / 月视图 | 满足不同查看需求 |
| 解析确认 | AI 解析后先预览，用户确认再添加 | 避免误解析直接入库 |
| 点击编辑 | 点击日程可修改内容 | 基础编辑能力 |
| 冲突检测 | 新增日程时检查时间重叠 | 避免 double booking |
| 快捷输入模板 | 提供常用句式示例 | 降低使用门槛 |
| 拖拽调整 | 拖拽改变日程时间 | 提升操作效率 |

### 3.3 P2 可选功能（有余力再做）

| 功能 | 描述 | 价值 |
|------|------|------|
| 导出 .ics 文件 | 可导入系统日历 | 与现有工具打通 |
| 重复日程 | 支持"每周一"、"每天"等周期任务 | 常见需求 |
| 日程搜索 | 按关键词搜索历史日程 | 日程多了以后需要 |
| 日程提醒 | 设置提前提醒时间 | 实用功能 |
| 同步 Google Calendar | 双向同步 | 生态打通 |
| 暗色模式 | 深色主题 | 体验加分 |

---

## 四、技术选型

### 4.1 整体架构

```
┌─────────────────────────────────────────────────────┐
│                    前端 (React)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │   输入框     │  │   日历组件   │  │  事件弹窗     │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────┐
│                  后端 API (Next.js)                  │
│              POST /api/parse-event                  │
└─────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────┐
│                  Claude API                         │
│               (Tool Use 结构化输出)                   │
└─────────────────────────────────────────────────────┘
```

### 4.2 技术栈选择

| 层面 | 选择 | 备选方案 | 选择理由 |
|------|------|----------|----------|
| 前端框架 | React + TypeScript | Vue 3 | 生态成熟，类型安全 |
| 日历组件 | react-big-calendar | FullCalendar | 功能与复杂度平衡 |
| AI 解析 | Claude API (Tool Use) | OpenAI Function Calling | 结构化输出更可靠 |
| 样式方案 | Tailwind CSS | CSS Modules | 快速开发，一致性好 |
| 构建工具 | Vite | Create React App | 启动快，HMR 体验好 |
| 数据存储 | localStorage | IndexedDB | MVP 阶段够用 |
| 部署 | Vercel | - | Next.js 原生支持 |

### 4.3 日历组件库对比

| 组件库 | 特点 | 学习成本 | 推荐场景 |
|--------|------|----------|----------|
| **FullCalendar** | 功能最全，支持拖拽、多视图、资源调度 | 高 | 企业级复杂项目 |
| **react-big-calendar** | 轻量，API 简洁，类似 Google Calendar | 中 | 个人项目、中等复杂度 ✅ |
| **react-calendar** | 极简，只有月视图选择器 | 低 | 只需日期选择 |
| **@schedule-x/react** | 新秀，现代化设计 | 中 | 追求美观 |

**最终选择**：react-big-calendar（平衡功能和复杂度）

### 4.4 AI 解析方案对比

| 方案 | 优点 | 缺点 |
|------|------|------|
| 纯 Prompt + JSON 解析 | 简单直接 | 输出格式不稳定，需要容错处理 |
| **Tool Use / Function Calling** | 输出结构可靠，自动校验 schema | 需要定义工具 schema ✅ |
| 本地 NLP 库 | 无 API 费用 | 解析能力弱，开发成本高 |

**最终选择**：Claude Tool Use（结构化输出最可靠）

---

## 五、数据结构设计

### 5.1 日历事件核心结构

```typescript
interface CalendarEvent {
  id: string;                    // 唯一标识
  title: string;                 // 事件标题
  start: Date;                   // 开始时间
  end: Date;                     // 结束时间
  isAllDay: boolean;             // 是否全天事件
  location?: string;             // 地点
  description?: string;          // 描述
  attendees?: string[];          // 参与者
  color?: string;                // 显示颜色
  recurrence?: RecurrenceRule;   // 重复规则
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
}
```

### 5.2 重复规则结构

```typescript
interface RecurrenceRule {
  freq: "daily" | "weekly" | "monthly" | "yearly";
  interval: number;              // 间隔，如每2周
  byDay?: ("MO" | "TU" | "WE" | "TH" | "FR" | "SA" | "SU")[];
  byMonthDay?: number;           // 每月几号
  until?: Date;                  // 结束日期
  count?: number;                // 或重复次数
}
```

### 5.3 API 请求/响应结构

**请求：**
```typescript
interface ParseEventRequest {
  text: string;           // 用户自然语言输入
  timezone?: string;      // 用户时区，默认 Asia/Shanghai
  referenceTime?: string; // 参考时间（可选，用于测试）
}
```

**成功响应：**
```typescript
interface ParseEventResponse {
  success: true;
  data: {
    id: string;
    title: string;
    start: string;         // ISO 8601 格式
    end: string;
    isAllDay: boolean;
    location?: string;
    attendees?: string[];
    recurrence?: RecurrenceRule;
    meta: {
      confidence: number;  // 0-1 解析置信度
      rawInput: string;    // 原始输入
      warnings?: string[]; // 解析警告
    };
  };
}
```

**失败响应：**
```typescript
interface ParseEventError {
  success: false;
  error: {
    code: "PARSE_FAILED" | "INVALID_INPUT" | "API_ERROR";
    message: string;
    suggestions?: string[];
  };
}
```

---

## 六、AI Prompt 设计要点

### 6.1 System Prompt 核心要素

1. **注入当前时间**：让 AI 知道"今天"是哪天、星期几
2. **定义时间解析规则**：
   - 相对时间：明天、下周X、X天后
   - 时间点：上午/下午/晚上的默认时间
   - 持续时间：未指定默认1小时
3. **定义输出格式**：使用 Tool Use 确保结构化输出
4. **置信度评估**：0.9+ 确定，0.7-0.9 中等，<0.7 需要确认

### 6.2 时间解析规则表

| 表达 | 解析规则 |
|------|----------|
| 今天/明天/后天 | 基于当前日期计算 |
| 下周X | 下一个自然周的周X |
| 这周X | 本周的周X |
| X天后 | 当前日期 + X天 |
| 上午 | 09:00（除非指定） |
| 下午 | 14:00（除非指定） |
| 晚上 | 19:00（除非指定） |
| X点 | X:00，根据上下文推断上午/下午 |

### 6.3 解析示例

| 输入 | 解析结果 |
|------|----------|
| 明天下午3点开会 | 明天 15:00-16:00 |
| 下周三和老王吃饭 | 下周三 12:00-13:00（午饭推断） |
| 每周一早上9点站会，30分钟 | 周一 09:00-09:30，weekly |
| 1月30号全天休假 | 2026-01-30，isAllDay: true |

---

## 七、开发计划

### 7.1 里程碑规划

| 阶段 | 目标 | 主要任务 | 预计耗时 |
|------|------|----------|----------|
| M1 | 项目初始化 | 创建项目、定义数据结构 | 0.5 天 |
| M2 | AI 解析服务 | 实现后端 API，调用 Claude | 1 天 |
| M3 | 基础日历视图 | 渲染日历，显示假数据 | 0.5 天 |
| M4 | 核心链路打通 | 输入框 + API + 日历联调 | 1 天 |
| M5 | 事件管理 | 查看详情、编辑、删除 | 0.5 天 |
| M6 | 数据持久化 | localStorage 存储 | 0.5 天 |
| M7 | 体验优化 | 解析确认、冲突检测、快捷模板 | 1 天 |

**MVP 总计**：约 5 天

### 7.2 开发顺序

```
1. 数据结构定义（前后端契约）
        ↓
2. AI 解析服务（可用 curl 独立测试）
        ↓
3. 基础日历视图（用假数据验证）
        ↓
4. 输入框 + API 调用（核心链路）
        ↓
5. 事件管理（增删改）
        ↓
6. 数据持久化
        ↓
7. 体验优化
```

### 7.3 各阶段验收标准

| 阶段 | 验收标准 |
|------|----------|
| M1 | TypeScript 类型可导入，`tsc --noEmit` 无报错 |
| M2 | `curl` 测试 5 个用例全部返回正确结构 |
| M3 | 页面显示日历，假数据事件在正确位置 |
| M4 | 输入"明天下午3点开会"→ 日历显示对应事件 |
| M5 | 点击事件弹出详情，可删除，删除后消失 |
| M6 | 刷新页面后事件仍然存在 |
| M7 | 低置信度显示警告，快捷模板可点击填入 |

---

## 八、风险与应对

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| AI 解析不准确 | 用户体验差 | 增加解析确认步骤，显示置信度 |
| 时间歧义 | 日程时间错误 | Prompt 中定义明确规则，warnings 提示 |
| API 调用延迟 | 等待时间长 | 添加 loading 状态，优化 Prompt 长度 |
| API 费用 | 成本增加 | 限制调用频率，缓存相似请求 |

---

## 九、后续扩展方向

1. **多端同步**：接入云数据库，支持多设备同步
2. **智能建议**：根据历史日程推荐最佳时间
3. **团队协作**：支持多人日程协调、会议邀请
4. **语音输入**：支持语音转文字再解析
5. **第三方集成**：对接飞书、钉钉、Outlook 等

---

## 十、参考资料

- [react-big-calendar 文档](https://github.com/jquense/react-big-calendar)
- [Claude API 文档](https://docs.anthropic.com/)
- [iCalendar RFC 5545](https://tools.ietf.org/html/rfc5545)
- [date-fns 文档](https://date-fns.org/)

---

## 附录：测试用例

用于验证 AI 解析服务的测试用例：

| 序号 | 输入 | 期望输出 |
|------|------|----------|
| 1 | 明天下午3点开会 | start: 明天 15:00, end: 明天 16:00 |
| 2 | 下周一早上9点站会，30分钟 | start: 下周一 09:00, end: 09:30 |
| 3 | 每周五下午团建 | recurrence: weekly, byDay: ["FR"] |
| 4 | 1月30号全天休假 | isAllDay: true |
| 5 | 后天晚上8点到10点看电影 | start: 后天 20:00, end: 22:00 |
| 6 | 和老王在星巴克聊项目 | confidence < 0.7, warnings: "未指定时间" |
